#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/behaviors.h>
#include <dt-bindings/zmk/pointing.h>
#include <locale/keys_hu.h>

#define BASE 0
#define SYM  1
#define NAVCTRL  2
#define FNNUM 3
#define BTMOUSE 4
#define BASE_IPAD 5
#define SYM_IPAD 6
#define NAVCTRL_IPAD 7
#define FNNUM_IPAD 8
#define BTMOUSE_IPAD 9

#define HU_LDQT (RA(HU_O))
#define HU_RDQT (RA(HU_P))
#define HU_EMDASH (RA(HU_Z))

#define HU_IPAD_SECT (HU_SECT)
#define HU_IPAD_PIPE (RA(HU_I_ACUTE))
#define HU_IPAD_CARET (RA(HU_A_ACUTE))
#define HU_IPAD_PLUS (HU_PLUS)
#define HU_IPAD_TILDE (RA(HU_U_ACUTE))
#define HU_IPAD_PERCENT (HU_PERCENT)
#define HU_IPAD_LPAR (HU_LPAR)
#define HU_IPAD_RPAR (HU_RPAR)
#define HU_IPAD_EQUAL (HU_EQUAL)
#define HU_IPAD_GRAVE (RA(HU_U_DOUBLE_ACUTE))
#define HU_IPAD_BACKSLASH (RA(HU_U_UMLAUT))
#define HU_IPAD_LBKT (HU_LBKT)
#define HU_IPAD_RBKT (HU_RBKT)
#define HU_IPAD_EXCL (HU_EXCL)
#define HU_IPAD_SEMI (HU_SEMI)
#define HU_IPAD_SQT (HU_SQT)
#define HU_IPAD_DQT (HU_DQT)
#define HU_IPAD_LDQT (RA(HU_V))
#define HU_IPAD_DOLLAR (RA(HU_N4))
#define HU_IPAD_HASH (RA(LS(HU_N3)))
#define HU_IPAD_AMPS (RA(HU_N1))
#define HU_IPAD_AT (RA(HU_Q))
#define HU_IPAD_LBRC (RA(HU_N7))
#define HU_IPAD_RBRC (RA(HU_O_UMLAUT))
#define HU_IPAD_LT (RA(LS(HU_Y)))
#define HU_IPAD_GT (RA(LS(HU_X)))
#define HU_IPAD_SLASH (HU_SLASH)
#define HU_IPAD_ASTERISK (RA(LS(HU_COMMA)))
#define HU_IPAD_RDQT (RA(HU_B)
#define HU_IPAD_EMDASH (RA(HU_MINUS))

#define KEYS_L 0 1 2 3 4 10 11 12 13 14 20 21 22 23 24 25 // Left-hand keys.
#define KEYS_R 5 6 7 8 9 15 16 17 18 19 26 27 28 29 30 31 // Right-hand keys.
#define THUMBS 32 33 34 35 36 37 // Thumb keys.

/ {
	behaviors {
		hml: home_row_mod_left {
			compatible = "zmk,behavior-hold-tap";
			#binding-cells = <2>;
			flavor = "balanced";
			require-prior-idle-ms = <150>;
			tapping-term-ms = <280>;
			quick-tap-ms = <175>;
			bindings = <&kp>, <&kp>;
			hold-trigger-key-positions = <KEYS_R THUMBS>;
			hold-trigger-on-release;
		};
		hmr: home_row_mod_right {
			compatible = "zmk,behavior-hold-tap";
			#binding-cells = <2>;
			flavor = "balanced";
			require-prior-idle-ms = <150>;
			tapping-term-ms = <280>;
			quick-tap-ms = <175>;
			bindings = <&kp>, <&kp>;
			hold-trigger-key-positions = <KEYS_L THUMBS>;
			hold-trigger-on-release;
		};
	};
	
	combos {
		compatible = "zmk,combos";
		combo_backspace {
			timeout-ms = <50>;
			layers = <BASE BASE_IPAD>;
			key-positions = <6 7>;
			bindings = <&kp BACKSPACE>;
		};
		combo_delete {
			timeout-ms = <50>;
			layers = <BASE BASE_IPAD>;
			key-positions = <7 8>;
			bindings = <&kp DEL>;
		};
		combo_insert {
			timeout-ms = <50>;
			layers = <BASE BASE_IPAD>;
			key-positions = <8 9>;
			bindings = <&kp INS>;
		};
		combo_exclamation {
			timeout-ms = <50>;
			layers = <BASE BASE_IPAD>;
			key-positions = <27 28>;
			bindings = <&kp HU_EXCL>;
		};
		combo_semicolon {
			timeout-ms = <50>;
			layers = <BASE BASE_IPAD>;
			key-positions = <28 29>;
			bindings = <&kp HU_SEMI>;
		};
		combo_asterisk {
			timeout-ms = <50>;
			layers = <BASE>;
			key-positions = <29 30>;
			bindings = <&kp HU_ASTERISK>;
		};
		combo_asterisk_ipad {
			timeout-ms = <50>;
			layers = <BASE_IPAD>;
			key-positions = <29 30>;
			bindings = <&kp HU_IPAD_ASTERISK>;
		};
		combo_word_start {
			timeout-ms = <50>;
			layers = <NAVCTRL>;
			key-positions = <27 28>;
			bindings = <&kp LC(LEFT)>;
		};
		combo_word_end {
			timeout-ms = <50>;
			layers = <NAVCTRL>;
			key-positions = <28 29>;
			bindings = <&kp LC(RIGHT)>;
		};
		combo_word_start_mac {
			timeout-ms = <50>;
			layers = <NAVCTRL_IPAD>;
			key-positions = <27 28>;
			bindings = <&kp LA(LEFT)>;
		};
		combo_word_end_mac {
			timeout-ms = <50>;
			layers = <NAVCTRL_IPAD>;
			key-positions = <28 29>;
			bindings = <&kp LA(RIGHT)>;
		};
    	};

    	macros {
		teams_leave: teams_leave {
		    label = "teams_leave";
		    compatible = "zmk,behavior-macro";
		    #binding-cells = <0>;
		    bindings
		        = <&macro_tap &kp LG(HU_N5)>
		        , <&macro_tap &kp LC(LS(HU_H))>
		        ;
		};
		teams_sound: teams_sound {
		    label = "teams_sound";
		    compatible = "zmk,behavior-macro";
		    #binding-cells = <0>;
		    bindings
		        = <&macro_tap &kp LG(HU_N5)>
		        , <&macro_tap &kp LC(LS(HU_M))>
		        ;
		};
		teams_camera: teams_camera {
		    label = "teams_camera";
		    compatible = "zmk,behavior-macro";
		    #binding-cells = <0>;
		    bindings
		        = <&macro_tap &kp LG(HU_N5)>
		        , <&macro_tap &kp LC(LS(HU_O))>
		        ;
		};
	};

	keymap {
		compatible = "zmk,keymap";
		
		base_layer {
			label= "BASE";
			bindings = <
			&kp HU_Q &kp HU_W &kp HU_F &kp HU_P &kp HU_B &kp HU_J &kp HU_L &kp HU_U &kp HU_Z &kp HU_O_UMLAUT
			&kp HU_A &hml LGUI HU_R &hml LALT HU_S &hml LCTRL HU_T &kp HU_G &kp HU_M &hmr LCTRL HU_N &hmr LALT HU_E &hmr LGUI HU_I &kp HU_O
			&kp TAB &kp HU_Y &kp HU_X &kp HU_C &kp HU_D &kp HU_V &kp HU_H &kp HU_K &kp HU_COMMA &kp HU_DOT &kp HU_MINUS &kp HU_U_UMLAUT
			&lt BTMOUSE ESC &mo SYM &lt FNNUM ENTER &kp SPACE &kp LSHIFT &mo NAVCTRL
		        >;
		};
                
        sym_layer {
			label= "SYM";
			bindings = <
			&kp HU_SECT &kp HU_LBRC &kp HU_RBRC &kp HU_PLUS &kp HU_CARET &kp HU_PERCENT &kp HU_TILDE &kp HU_U_ACUTE &kp HU_EQUAL &kp HU_O_DOUBLE_ACUTE
			&kp HU_A_ACUTE &hml LGUI HU_LPAR &hml LALT HU_RPAR &hml LCTRL HU_SQT &kp HU_BACKSLASH &kp HU_SLASH &hmr LCTRL HU_DQT &hmr LALT HU_E_ACUTE &hmr LGUI HU_I_ACUTE &kp HU_O_ACUTE
			&kp HU_GRAVE &kp HU_HASH &kp HU_LBKT &kp HU_RBKT &kp HU_AT &kp HU_LT &kp HU_GT &kp HU_AMPS &kp HU_PIPE &kp HU_DOLLAR &kp HU_EMDASH &kp HU_U_DOUBLE_ACUTE
			&none &trans &none &trans &trans &kp RALT
                        >;
                };
		
	navctrl_layer {
			label= "NAVCTRL";
			bindings = <
			&kp LC(HU_Y) &kp C_PREV &kp C_PLAY_PAUSE &kp C_NEXT &kp C_VOL_UP &kp C_BRI_UP &kp BACKSPACE &kp DEL &kp INS &caps_word
			&none &kp LGUI &kp LALT &kp LCTRL &kp C_VOL_DN &kp C_BRI_DN &kp LEFT &kp DOWN &kp UP &kp RIGHT
			&kp CAPSLOCK &kp LC(HU_Z) &kp LC(HU_X) &kp LC(HU_C) &kp LC(HU_V) &kp C_MUTE &kp PRINTSCREEN &kp HOME &kp PG_DN &kp PG_UP &kp END &to BASE_IPAD
			&tog NAVCTRL &kp LSHIFT &kp ENTER &none &none &trans
                        >;
                };
                
        fnnum_layer {
			label= "FNNUM";
			bindings = <
			&kp HU_PLUS &kp HU_MINUS &kp HU_ASTERISK &kp HU_SLASH &kp HU_EQUAL &none &kp F1 &kp F2 &kp F3 &kp F4
			&kp HU_N0 &hml LGUI HU_N1 &hml LALT HU_N2 &hml LCTRL HU_N3 &kp HU_N4 &none &hmr LCTRL F5 &hmr LALT F6 &hmr LGUI F7 &kp F8
			&none &kp HU_N5 &kp HU_N6 &kp HU_N7 &kp HU_N8 &kp HU_N9 &none &kp F9 &kp F10 &kp F11 &kp F12 &none
			&trans &trans &trans &trans &trans &sk RALT
                        >;
                };

        btmouse_layer {
			label= "BTMOUSE";
			bindings = <
			&bt BT_DISC 0 &bt BT_DISC 1 &bt BT_DISC 2 &bt BT_DISC 3 &bt BT_DISC 4 &none &teams_leave &teams_sound &teams_camera &none
			&msc SCRL_LEFT &msc SCRL_DOWN &msc SCRL_UP &msc SCRL_RIGHT &bt BT_CLR &none &mmv MOVE_LEFT &mmv MOVE_DOWN &mmv MOVE_UP &mmv MOVE_RIGHT
			&bt BT_PRV &bt BT_SEL 0 &bt BT_SEL 1 &bt BT_SEL 2 &bt BT_SEL 3 &bt BT_SEL 4 &kp LSHIFT &kp LGUI &kp LALT &kp LCTRL &none &bt BT_NXT
			&trans &none &none &mkp RCLK &mkp LCLK &tog BTMOUSE
                        >;
                };
		
		base_ipad_layer {
			label= "BASE_IPAD";
			bindings = <
			&trans &trans &trans &trans &trans &trans &trans &trans &trans &trans
			&hml GLOBE HU_A &hml LCTRL HU_R &trans &hml LGUI HU_T &trans &trans &hmr LGUI HU_N &trans &hmr LCTRL HU_I &hmr GLOBE HU_O
			&trans &trans &trans &trans &trans &trans &trans &trans &trans &trans &trans &trans
			&lt BTMOUSE_IPAD ESC &mo SYM_IPAD &lt FNNUM_IPAD ENTER &trans &trans &mo NAVCTRL_IPAD
                        >;
                };
                
        sym_ipad_layer {
			label= "SYM_IPAD";
			bindings = <
			&kp HU_IPAD_SECT &kp HU_IPAD_LBRC &kp HU_IPAD_RBRC &kp HU_IPAD_PLUS &kp HU_IPAD_CARET &kp HU_IPAD_PERCENT &kp HU_IPAD_TILDE &kp HU_U_ACUTE &kp HU_IPAD_EQUAL &kp HU_O_DOUBLE_ACUTE
			&hml GLOBE HU_A_ACUTE &hml LCTRL HU_IPAD_LPAR &hml LALT HU_IPAD_RPAR &hml LGUI HU_IPAD_SQT &kp HU_IPAD_BACKSLASH &kp HU_IPAD_SLASH &hmr LGUI HU_IPAD_DQT &hmr LALT HU_E_ACUTE &hmr LCTRL HU_I_ACUTE &hmr GLOBE HU_O_ACUTE
			&kp HU_IPAD_GRAVE &kp HU_IPAD_HASH &kp HU_IPAD_LBKT &kp HU_IPAD_RBKT &kp HU_IPAD_AT &kp HU_IPAD_LT &kp HU_IPAD_GT &kp HU_IPAD_AMPS &kp HU_IPAD_PIPE &kp HU_IPAD_DOLLAR &kp HU_IPAD_EMDASH &kp HU_U_DOUBLE_ACUTE
			&none &trans &none &trans &trans &sk RALT
                        >;
                };
                
        navctrl_ipad_layer {
			label= "NAVCTRL_IPAD";
			bindings = <
			&kp LG(HU_Y) &kp C_PREV &kp C_PLAY_PAUSE &kp C_NEXT &kp C_VOL_UP &kp C_BRI_UP &kp BACKSPACE &kp DEL &kp INS &caps_word
			&kp GLOBE &kp LCTRL &kp LALT &kp LGUI &kp C_VOL_DN &kp C_BRI_DN &kp LEFT &kp DOWN &kp UP &kp RIGHT
			&kp CAPSLOCK &kp LG(HU_Z) &kp LG(HU_X) &kp LG(HU_C) &kp LG(HU_V) &kp C_MUTE &kp PRINTSCREEN &kp LC(LEFT) &kp PG_DN &kp PG_UP &kp LC(RIGHT) &to BASE
			&tog NAVCTRL_IPAD &kp LSHIFT &kp ENTER &none &none &trans
                        >;
                };
                
        fnnum_ipad_layer {
			label= "FNNUM_IPAD";
			bindings = <
			&kp HU_IPAD_PLUS &kp HU_MINUS &kp HU_IPAD_ASTERISK &kp HU_IPAD_SLASH &kp HU_IPAD_EQUAL &none &kp F1 &kp F2 &kp F3 &kp F4
			&hml GLOBE HU_N0 &hml LCTRL HU_N1 &hml LALT HU_N2 &hml LGUI HU_N3 &kp HU_N4 &none &hmr LGUI F5 &hmr LALT F6 &hmr LCTRL F7 &hmr GLOBE F8
			&none &kp HU_N5 &kp HU_N6 &kp HU_N7 &kp HU_N8 &kp HU_N9 &none &kp F9 &kp F10 &kp F11 &kp F12 &none
			&trans &trans &trans &trans &trans &sk RALT
                        >;
                };
                
        btmouse_ipad_layer {
			label= "BTMOUSE_IPAD";
			bindings = <
			&bt BT_DISC 0 &bt BT_DISC 1 &bt BT_DISC 2 &bt BT_DISC 3 &bt BT_DISC 4 &none &none &none &none &none
			&msc SCRL_LEFT &msc SCRL_DOWN &msc SCRL_UP &msc SCRL_RIGHT &bt BT_CLR &none &mmv MOVE_LEFT &mmv MOVE_DOWN &mmv MOVE_UP &mmv MOVE_RIGHT
			&bt BT_PRV &bt BT_SEL 0 &bt BT_SEL 1 &bt BT_SEL 2 &bt BT_SEL 3 &bt BT_SEL 4 &kp LSHIFT &kp LGUI &kp LALT &kp LCTRL &kp GLOBE &bt BT_NXT
			&trans &none &none &mkp RCLK &mkp LCLK &tog BTMOUSE_IPAD
                        >;
                };
        };
};
